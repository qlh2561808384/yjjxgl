var newNodes=[{id:1,pId:0,name:"节点1",ISLEAF:0,open:true},{id:11,pId:1,name:"节点1-1",ISLEAF:1},{id:12,pId:1,name:"节点1-2",ISLEAF:1},{id:2,pId:0,name:"节点2",ISLEAF:0,open:true},{id:21,pId:2,name:"节点2-1",ISLEAF:1}];function openOptions(t){var plugObj=$(t).parent().siblings(".view").find("[dtype]"),plugObjId=plugObj.attr("id"),dtype=plugObj.attr("dtype"),$view=$(t).parent().siblings(".view"),$sideTree=$("#sideTree"),nodeArr=$sideTree.tree("getTree").getNodesByParam("dragId",plugObjId),optionsFormId="optionsForm",defaultTreeData="./example/json/treeData.json";$.dopen({btn:["保存","取消"],type:1,area:["900px","500px"],colseBtn:1,fix:true,title:"属性配置",content:'<form id="'+optionsFormId+'"></form>',btn1:function(index){var plugOptions=$("#"+optionsFormId).dform("getData");$.each(plugOptions,function(key,val){if(val===""){delete plugOptions[key]}else{if(val==="1"||val==="0"){plugOptions[key]=parseInt(val)}}});$.each(plugOptions,function(i,n){if(n!==undefined&&(i==="localdata"||i==="columns"||i==="data"||i==="inputs")){try{plugOptions[i]=eval("("+plugOptions[i]+")")}catch(e){throw new Error("对象字符串异常")}}});if(dtype.toLowerCase().indexOf("tree")!==-1){plugOptions.data={};var keyArr=["checked","name"];var simpleDataArr=["enable","idKey","pIdKey","rootPId"];var dataArr=[keyArr,simpleDataArr];var dataTypeArr=["key","simpleData"];$.each(dataArr,function(i,n){var dataType=dataTypeArr[i];$.each(dataArr[i],function(j,m){var dataVal=dataArr[i][j];if(plugOptions[dataVal]!==undefined){if(plugOptions.data[dataType]===undefined){plugOptions.data[dataType]={}}plugOptions.data[dataType][dataVal]=plugOptions[dataVal];delete plugOptions[dataVal]}})});if(Object.keys(plugOptions.data).length===0){delete plugOptions.data}}var plugOptionsClone=cloneObj(plugOptions);$.each(plugOptionsClone,function(key,val){if(dtype.toLowerCase().indexOf("tree")!==-1){if(parseInt(plugOptionsClone.dataMethod)!==1){delete nodeArr[0].dragAll.localdata;delete plugOptionsClone.localdata}else{delete nodeArr[0].dragAll.url;delete plugOptionsClone.url}}nodeArr[0].dragAll[key]=plugOptionsClone[key]});$sideTree.tree("getTree").updateNode(nodeArr[0]);if(dtype==="dtable"||dtype==="dform"){$view.empty()}else{plugObj[dtype]("destroy")}$view.append('<div class="layoutClass" id="'+plugObjId+'" dtype="'+dtype+'"></div>');plugObj=$view.find("[dtype="+dtype+"]");plugObj[dtype](plugOptions);layer.close(index)},btn2:function(index){layer.close(index)}});var optionsFormObj=$("#"+optionsFormId);if(dtype==="tree"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"是否加“全部”rootElement",name:"rootElement",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"父节点是否可选ISLEAF",name:"ISLEAF",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"选择框类型checkType",name:"checkType",type:"comboBox",localdata:[{id:"radio",text:"radio"},{id:"checkbox",text:"checkbox"}],defaultvalue:"radio"},{title:"是否显示搜索框openSearch",name:"openSearch",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"data.key.name",name:"name",type:"textBox",placeholder:"name"},{title:"data.simpleData.idKey",name:"idKey",type:"textBox",placeholder:"id"},{title:"data.simpleData.pIdKey",name:"pIdKey",type:"textBox",placeholder:"pId"},{title:"data.simpleData.rootPId",name:"rootPId",type:"textBox",placeholder:"0"},{title:"数据方式",name:"dataMethod",id:"tree-dataMethod",type:"comboBox",localdata:[{id:0,text:"url"},{id:1,text:"localdata"}],defaultvalue:"url",colspan:"2",onChange:function(newValue,oldValue){if(newValue==0){$("#treeData-url").textBox("enable");$("#treeData-localdata").textBox("disable")}else{if(newValue==1){$("#treeData-localdata").textBox("enable");$("#treeData-url").textBox("disable")}}}},{title:"远程数据url",name:"url",id:"treeData-url",type:"textBox",colspan:"2",placeholder:defaultTreeData,defaultvalue:defaultTreeData},{title:"本地数据localdata",name:"localdata",id:"treeData-localdata",type:"textBox",multiline:true,colspan:"2"}]})}else{if(dtype==="comboTree"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"下拉面板高度panelHeight",name:"panelHeight",type:"textBox"},{title:"是否多选multiple",name:"multiple",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"父节点是否不可选onlyLeaf",name:"onlyLeaf",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"是否加“全部”rootElement",name:"rootElement",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"data.key.name",name:"name",type:"textBox",placeholder:"name"},{title:"data.key.title",name:"title",type:"textBox"},{title:"data.key.url",name:"dataurl",type:"textBox"},{title:"data.simpleData.idKey",name:"idKey",type:"textBox",placeholder:"id"},{title:"data.simpleData.pIdKey",name:"pIdKey",type:"textBox",placeholder:"pId"},{title:"data.simpleData.rootPId",name:"rootPId",type:"textBox",placeholder:"0"},{title:"数据方式",name:"dataMethod",id:"tree-dataMethod",type:"comboBox",localdata:[{id:0,text:"url"},{id:1,text:"localdata"}],defaultvalue:"url",colspan:"2",onChange:function(newValue,oldValue){if(newValue==0){$("#treeData-url").textBox("enable");$("#treeData-localdata").textBox("disable")}else{if(newValue==1){$("#treeData-localdata").textBox("enable");$("#treeData-url").textBox("disable")}}}},{title:"远程数据url",name:"url",id:"treeData-url",type:"textBox",colspan:"2",placeholder:defaultTreeData,defaultvalue:defaultTreeData},{title:"本地数据localdata",name:"localdata",id:"treeData-localdata",type:"textBox",multiline:true,colspan:"2"}]})}else{if(dtype==="searchTree"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"模态框标题modalTitle",name:"modalTitle",type:"textBox"},{title:"是否加“全部”rootElement",name:"rootElement",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"父节点是否可选ISLEAF",name:"ISLEAF",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"},{title:"选择框类型checkType",name:"checkType",type:"comboBox",localdata:[{id:"radio",text:"radio"},{id:"checkbox",text:"checkbox"}],defaultvalue:"radio"},{title:"data.key.name",name:"name",type:"textBox",placeholder:"name"},{title:"data.simpleData.idKey",name:"idKey",type:"textBox",placeholder:"id"},{title:"data.simpleData.pIdKey",name:"pIdKey",type:"textBox",placeholder:"pId"},{title:"data.simpleData.rootPId",name:"rootPId",type:"textBox",placeholder:"0"},{title:"数据方式",name:"dataMethod",id:"tree-dataMethod",type:"comboBox",localdata:[{id:0,text:"url"},{id:1,text:"localdata"}],defaultvalue:"url",colspan:"2",onChange:function(newValue,oldValue){if(newValue==0){$("#treeData-url").textBox("enable");$("#treeData-localdata").textBox("disable")}else{if(newValue==1){$("#treeData-localdata").textBox("enable");$("#treeData-url").textBox("disable")}}}},{title:"远程数据url",name:"url",id:"treeData-url",type:"textBox",colspan:"2",placeholder:defaultTreeData,defaultvalue:defaultTreeData},{title:"本地数据localdata",name:"localdata",id:"treeData-localdata",type:"textBox",multiline:true,colspan:"2"}]})}else{if(dtype==="textBox"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"宽度width",name:"width",type:"textBox",placeholder:"100%"},{title:"默认值defaultValue",name:"defaultValue",type:"textBox"},{title:"提示信息placeholder",name:"placeholder",type:"textBox"},{title:"是否多选multiline",name:"multiline",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"false"}],defaultvalue:"false"}]})}else{if(dtype==="dateBox"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"宽度width",name:"width",type:"textBox",placeholder:"100%"},{title:"日期格式format",name:"format",type:"comboBox",localdata:[{id:"yyyy-mm-dd",text:"yyyy-mm-dd"},{id:"mm-dd",text:"mm-dd"}],defaultvalue:"yyyy-mm-dd"}]})}else{if(dtype==="comboBox"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"input宽度width",name:"width",type:"textBox",placeholder:"100%"},{title:"默认选中selected",name:"selected",type:"textBox",placeholder:"0"},{title:"是否添加'全部'searchOption",name:"searchOption",type:"comboBox",localdata:[{id:"2",text:"null"},{id:"1",text:"true"},{id:"0",text:"false"}],defaultvalue:"null"},{title:"下拉面板宽度panelWidth",name:"panelWidth",type:"textBox",placeholder:"auto"},{title:"下拉面板高度panelHeight",name:"panelHeight",type:"textBox",placeholder:"auto"},{title:"分隔符separator",name:"separator",type:"textBox",placeholder:","},{title:"是否多选multiple",name:"multiple",type:"comboBox",localdata:[{id:"1",text:"true"},{id:"0",text:"false"}],defaultvalue:"false"},{title:"远程数据url",name:"url",type:"textBox"},{title:"本地数据localdata",name:"localdata",type:"textBox",multiline:true,colspan:"2",defaultValue:comboBoxDataStr}]})}else{if(dtype==="decimal"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"小数位数decimalPlaces",name:"decimalPlaces",type:"textBox",defaultValue:"2"}]})}else{if(dtype==="dtable"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"表格高度height",name:"height",type:"textBox"},{title:"无数据显示undefinedText",name:"undefinedText",type:"textBox",placeholder:"-"},{title:"是否隔行变色striped",name:"striped",type:"comboBox",localdata:[{id:1,text:"true"},{id:0,text:"flase"}],defaultvalue:"true"},{title:"数据请求method",name:"method",type:"comboBox",localdata:[{id:"get",text:"get"},{id:"post",text:"post"}],defaultvalue:"get"},{title:"远程数据url",name:"url",type:"textBox"},{title:"列配置项columns",name:"columns",type:"textBox",multiline:true,colspan:2,defaultValue:tableColStr},{title:"本地数据data",name:"data",type:"textBox",multiline:true,colspan:2,defaultValue:tableDataStr}]})}else{if(dtype==="dform"){optionsFormObj.dform({rownum:2,labelwidth:"200px",inputs:[{title:"表单标题formtitle",name:"formtitle",type:"textBox"},{title:"每行控件数目rownum",name:"rownum",type:"textBox",placeholder:3},{title:"标签宽度labelwidth",name:"labelwidth",type:"textBox",placeholder:"50px"},{title:"组件数组inputs",name:"inputs",type:"textBox",multiline:true,colspan:"2",defaultValue:formInputsStr}]})}}}}}}}}}if(dtype.toLowerCase().indexOf("tree")!==-1){if($("#tree-dataMethod").comboBox("getValue")==="localdata"){$("#treeData-url").textBox("disable");$("#treeData-localdata").textBox("enable")}else{$("#treeData-url").textBox("enable");$("#treeData-localdata").textBox("disable")}}if(nodeArr[0]&&nodeArr[0].dragAll){$.each(nodeArr[0].dragAll,function(i,n){if(i==="localdata"||i==="columns"||i==="data"||i==="inputs"){nodeArr[0].dragAll[i]=JSON.stringify(n)}});optionsFormObj.dform("load",nodeArr[0].dragAll);$.each(nodeArr[0].dragAll,function(i,n){if(i==="localdata"||i==="columns"||i==="data"||i==="inputs"){nodeArr[0].dragAll[i]=JSON.parse(n)}})}}function openFormOptions(i){var d=$(i).parent().siblings(".view").children("[dtype]"),c=d.attr("id"),j=d.attr("dtype"),g=$(i).parent().siblings(".view"),a=$("#sideTree"),b=a.tree("getTree").getNodesByParam("dragId",c),h="optionsForm",e;$.dopen({btn:["保存","取消"],type:1,area:["900px","500px"],colseBtn:1,fix:true,title:"属性配置",content:'<form id="'+h+'"></form>',btn1:function(m){var l=$("#"+h).dform("getData");$.each(l,function(n,o){if(o==""){delete l[n]}else{if(o=="1"||o=="0"){l[n]=parseInt(o)}}});$.each(l,function(n,o){b[0].dragAll[n]=l[n]});var k=cloneObj(b[0].plug);b[0].plug=processForm(k);b[0].dragAll.inputs=cloneObj(b[0].plug);delete b[0].plug;a.tree("getTree").updateNode(b[0]);initContainer();layer.close(m)},btn2:function(k){layer.close(k)}});var f=$("#"+h);f.dform({rownum:2,labelwidth:"200px",inputs:[{title:"表单标题formtitle",name:"formtitle",type:"textBox"},{title:"标签宽度labelwidth",name:"labelwidth",type:"textBox",defaultValue:"50px"},{title:"form总控件数totalnum",name:"totalnum",type:"textBox",defaultValue:3},{title:"每行控件数目rownum",name:"rownum",type:"textBox",defaultValue:3},{title:"组件数组inputs",name:"inputs",type:"textBox",multiline:true,colspan:2,defaultValue:JSON.stringify(e)}]});if(b[0]&&b[0].dragAll.inputs){b[0].dragAll.inputs=JSON.stringify(b[0].dragAll.inputs);f.dform("load",b[0].dragAll);b[0].dragAll.inputs=JSON.parse(b[0].dragAll.inputs)}}function cloneObj(c){var d,b,a;if(typeof(c)!="object"||c===null){return c}if(c instanceof (Array)){d=[];b=0;a=c.length;for(;b<a;b++){if(typeof(c[b])=="object"&&c[b]!=null){d[b]=arguments.callee(c[b])}else{d[b]=c[b]}}}else{d={};for(b in c){if(typeof(c[b])=="object"&&c[b]!=null){d[b]=arguments.callee(c[b])}else{d[b]=c[b]}}}return d};