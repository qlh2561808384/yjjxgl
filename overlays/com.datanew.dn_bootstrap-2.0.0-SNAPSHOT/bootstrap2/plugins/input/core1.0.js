(function(j){j.extend({globalValid:j.extend({},{email:{reg:/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/,text:"邮箱格式错误"},idcard:{reg:/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/,text:"身份证格式错误"},phone:{reg:/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/,text:"手机号码格式错误"}},j.globalValidConfig),textBoxDefault:j.extend({},{width:"100%",height:"auto",thousandsNum:false,multiline:false,disabled:false,placeholder:"",required:false,defaultValue:"",validFail:function(i){return false},validSuccess:function(i){return false},onChange:function(){},onLoaded:function(i){}},j.textBoxConfig),dateBoxDefault:j.extend({},{language:"zh-CN",removeIcon:true,disabled:false,format:"yyyy-mm-dd",weekStart:1,todayBtn:1,autoclose:1,minView:2,todayHighlight:1,startView:4,forceParse:0,showMeridian:1,onChange:function(r,i){}},j.dateBoxConfig),comboBoxDefault:j.extend({},{valueField:"id",textField:"text",localdata:[],url:"",selected:"",queryParam:{},panelWidth:"auto",panelHeight:"auto",multiple:false,separator:",",disabled:false,hasDownArrow:true,value:"",onShowPanel:function(){return false},onHidePanel:function(){return false},onChange:function(r,i){},onClick:function(){return false}},j.comboBoxConfig),comboTreeDefault:j.extend({},{onlyLeaf:false,checkType:"nocheck",rootElement:false,check:{},data:{simpleData:{enable:true,idKey:"id",pIdKey:"pId",rootPId:"0"},key:{checked:"checked",children:"children",name:"name",title:"",url:""}},callback:{}},j.comboTreeConfig),searchTreeDefault:j.extend({},{openSearch:true,dblEnterSearch:false,modalWidth:"auto",modalHeight:"auto",modalTitle:"",onAckCallback:function(){return false},onChange:function(r,i){return false},onLoaded:function(){return false},callback:{},view:{}},j.searchTreeConfig),treeDefault:j.extend({},{async:{dataType:"text",autoParam:[],enable:false,otherParam:[],url:""},url:"",outerHeight:undefined,fixedTreeHeight:j(window).height()-40,rootElement:false,ISLEAF:false,checkType:"radio",queryParam:{},check:{},openSearch:false,data:{simpleData:{enable:true,idKey:"id",pIdKey:"pId",rootPId:"0"},key:{checked:"checked",children:"children",name:"name",title:"",url:""}},getValueField:"",view:{},callback:{clickNode:function(t,s,r,i){return false}},onLoaded:function(i){}},j.treeConfig),decimalDefault:j.extend({},{width:"100%",height:"auto",placeholder:"",required:false,defaultValue:"",decimalPlaces:2},j.decimalConfig)});var m=l({init:function(r,i){this.$textBox=j(r);this.$valueBox;this.$outerBox;this.options=i;this.initBox()}});j.fn.textBox=function(i){var t=j(this),s=null;if(typeof i=="object"){s=t.data("textBox");if(s!=null){s.options=j.extend({},s.options,i);return}i=j.extend({},j.textBoxDefault,i);if(i.multiline){t=j.replaceTag(j(this),"TEXTAREA")}else{t=j.replaceTag(j(this),"INPUT")}t.data("textBox",new m(t,i));t.data("type","textBox");i.onLoaded.call(this,t);return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=t.data("textBox");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};m.prototype.initBox=function(){var r=this.$textBox,i=this.options;if(i.multiline){if(i.height=="auto"){r.css({height:"80px",resize:"none"})}}this.$textBox.wrap('<span class="ztreeBox_inp ztreeBox_down "></span>').after("<input type='hidden' class='valueBox'/>").addClass("form-control input-sm").attr({placeholder:this.options.placeholder});this.$valueBox=r.next(".valueBox");this.$outerBox=r.parent().css({width:i.width,height:i.height});this.$valueBox=this.$outerBox.find(".valueBox").attr("boxType","textBox");if(i.id){this.$textBox.attr("id",i.id)}if(i.hasOwnProperty("dname")){this.$valueBox.attr("dname",i.dname)}if(this.$textBox.attr("dname")!=undefined){this.$valueBox.attr("dname",this.$textBox.attr("dname"));this.$textBox.removeAttr("dname")}if(i.hasOwnProperty("name")){this.$valueBox.attr("name",i.name)}if(this.$textBox.attr("name")!=undefined){this.$valueBox.attr("name",this.$textBox.attr("name"));this.$textBox.removeAttr("name")}try{if(i.defaultValue!=""){this.setValue(i.defaultValue)}}catch(s){}this.$textBox.addClass("bgwhite");this.$textBox.addClass("full");this.onTrigger()};m.prototype.onTrigger=function(){var t=this,s=this.$textBox,r=this.$valueBox;s.off("blur").on("blur",function(w){t.$outerBox.removeClass("has-error");r.val(s.val());if(t.options.required||t.options.validate){var u=t.validate();if(!u){t.options.validFail.apply(this,[t.$textBox])}else{t.options.validSuccess.apply(this,[t.$textBox])}}});s.off("keydown").on("keydown",function(u){r.val(s.val())});s.off("change").on("change",function(u){t.changeValue(t.$valueBox.val(),t.$textBox.val(),t.options)});if(this.options.thousandsNum){s.on("keyup",function(w){w=window.event||w;if(w.keyCode==37|w.keyCode==39){return}var u=s.val().replace(/[^\d.]/g,"");s.val(i(u)).on("blur",function(){r.val(u)})});function i(w){if(w==""||w==null){return w}else{var x=w.indexOf(".");if(x==-1){return(w||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")}else{var u=w.split(".");return(u[0]||0).toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,")+"."+u[1]}}}}};m.prototype.destroy=function(){this.$textBox.removeData("textBox");this.$outerBox.remove()};m.prototype.tips=function(r,i){layer.tips(r,i,{tipsMore:true,time:2000})};m.prototype.changeValue=function(w,u,t){var s=this.$textBox,r=this.$valueBox,i=this.$textBox.data("oldValue")==undefined?"":this.$textBox.data("oldValue");if(w==i){return}s.val(u);r.val(w);s.data("oldValue",w);this.options.onChange.apply(this,[w,i,t])};m.prototype.validate=function(){var r=true,x=j.trim(this.$valueBox.val()),w=this,s=this.options,u=this.$textBox;if(w.$textBox.is(":disabled")){return r}if(s.required&&x==""){this.tips("该选项为必填",this.$outerBox);this.$outerBox.addClass("has-error");return false}if(typeof s.validate=="function"){var y=s.validate.apply(s,[u.val(),x]);if(y&&y.result==false){this.tips(y.msg,w.$outerBox);this.$outerBox.addClass("has-error");return y.result}}else{if(typeof s.validate=="string"){var t=s.validate.split("|"),i;j.each(t,function(z,A){r=j.globalValid[A].reg.test(x);i=j.globalValid[A].text;if(!r){return false}});if(!r){w.tips(i,w.$outerBox)}}}if(r){this.$outerBox.removeClass("has-error")}else{this.$outerBox.addClass("has-error")}return r};m.prototype.clear=function(){this.$valueBox.val("");this.$textBox.val("")};m.prototype.getValue=function(){return this.$valueBox.val()};m.prototype.setValue=function(i){this.$valueBox.val(i);this.$textBox.val(i)};m.prototype.disable=function(){this.$textBox.attr("disabled","disabled").removeClass("bgwhite")};m.prototype.enable=function(){this.$textBox.removeAttr("disabled").addClass("bgwhite")};m.prototype.getText=function(){return this.$textBox.val()};m.prototype.setText=function(i){this.$textBox.val(i)};var a=l(m,{init:function(r,i){this.base(r,i);this.initDateBox()}});j.fn.dateBox=function(i){var t=j.replaceTag(j(this),"INPUT"),s=null;if(typeof i=="object"){i=j.extend({},j.extend({},j.textBoxDefault,j.dateBoxDefault),i);j.include([__bootstrapVersionPath+"/css/bootstrap.min.css",__bootstrapVersionPath+"/plugins/datetimepicker/css/bootstrap-datetimepicker.min.css",__bootstrapVersionPath+"/plugins/datetimepicker/js/bootstrap-datetimepicker.min.js",__bootstrapVersionPath+"/plugins/datetimepicker/js/locales/bootstrap-datetimepicker."+i.language+".js",__bootstrapVersionPath+"/plugins/datetimepicker/css/bootstrap-datetimepicker-custom.css"]);s=t.data("dateBox");if(s!=null){s.options=j.extend({},s.options,i);return}t.data("dateBox",new a(t,i));return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=t.data("dateBox");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};a.prototype.initDateBox=function(){var t=this.$textBox,i=this.options,s=this;t.css("border-right","none").attr("readonly","readonly");this.$outerBox.addClass("input-group date").css({display:"table",width:i.width=="100%"?"":i.width});var r="";if(i.removeIcon){r+='<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>'}r+='<span class="input-group-addon"><span class="glyphicon glyphicon-th"></span></span>';this.$valueBox.after(r);var u=this.$outerBox.datetimepicker(i);t.off("blur");u.on("hide",function(){s.validate()});if(i.disabled){t.attr("disabled","disabled");this.$outerBox.find(".input-group-addon").off("click")}this.$valueBox.attr("boxType","dateBox");return u};a.prototype.setValue=function(i){this.$textBox.val(i);this.$valueBox.val(i);this.$valueBox.datetimepicker("update")};a.prototype.disable=function(){var i=this.$outerBox.find(".glyphicon-remove").parent();var r=this.$outerBox.parent().find(".glyphicon-th").parent();i.off("click");r.off("click");this.$textBox.attr("disabled","disabled").removeClass("bgwhite")};a.prototype.enable=function(){var s=this.$textBox,i=this.$outerBox.find(".glyphicon-remove").parent(),r=this.$outerBox.find(".glyphicon-th").parent();i.on("click",function(){s.val("")});r.on("click",function(){s.trigger("focus")});this.$textBox.removeAttr("disabled").addClass("bgwhite")};var d=[];var n=l(m,{init:function(r,i){this.base(r,i);this.initPanel();this.initPanelContent();this.datas;this.$panel;this.$arrows;if(this.ztree){d.push(this)}}});j.fn.comboBox=function(i){var t=j.replaceTag(j(this),"INPUT"),s=null;if(typeof i=="object"){j.include([__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/zTreeStyle.css",__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/bootstrap-zTree-custom.css",__bootstrapVersionPath+"/plugins/tree/js/jquery.ztree.all.min.js"]);j.include([__bootstrapVersionPath+"/css/font-awesome.min.css"]);s=t.data("comboBox");if(s!=null){s.options=j.extend({},s.options,i);return}i=j.extend({},j.extend({},j.textBoxDefault,j.comboBoxDefault),i);t.data("comboBox",new n(t,i));t.data("type","comboBox");return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=j(this).data("comboBox");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};n.prototype.initPanel=function(){var t=this.$textBox,s=this,i=this.options;if(t.parent().siblings().is(".control-identify")){t.parent().siblings().remove()}if(i.labeltitle){if(i.labelbreadth==undefined){i.labelbreadth="100px"}t.parent().before('<label class="control-label control-identify" for="" style="width:'+i.labelbreadth+' ;line-height:30px;text-align:center;">'+i.labeltitle+"</label>");t.parent().parent().css("display","flex")}t.after('<i class="fa fa-angle-down combo-box-arrows"></i>').after('<div  class="combo-panel"></div>');this.$valueBox.attr("boxType","comboBox");this.$arrows=this.$outerBox.find(".fa.fa-angle-down");if(String(i.hasDownArrow)=="false"){this.$arrows.hide()}this.$panel=this.$outerBox.find(".combo-panel");var u=this.options.panelWidth;var r=this.options.panelHeight;this.$panel.css({width:u=="auto"?"100%":u,height:r});t.removeAttr("style").css({width:"100%"}).attr({readonly:"true"}).data("oldValue","");this.$valueBox.on("focus",function(){s.clickToggle()});this.$arrows.off("click").on("click",function(){s.clickToggle()});this.$textBox.off("click").on("click",function(){s.clickToggle()});this.$valueBox.off("focus").on("focus",function(){s.$textBox.trigger("click")})};var b=null;n.prototype.clickToggle=function(){this.options.onClick.apply(this,[]);b=d.indexOf(this);if(this.$panel.is(":hidden")){this.showPanel()}else{this.hidePanel()}};n.prototype.onTrigger=function(){};n.prototype.reload=function(i){this.clear();this.$panel.children().remove();if(i.hasOwnProperty("url")){this.options.url=i.url}else{this.options.localdata=i}if(i.hasOwnProperty("queryParam")){this.options.queryParam=i.queryParam}this.initPanelContent()};n.prototype.showPanel=function(){var i=this;b=d.indexOf(this);this.$panel.show();this.options.onShowPanel.apply(this,[this.$textBox]);j(document).on("mousedown",function(r){i.onBodyDown(r)})};n.prototype.onBodyDown=function(r){var i=j(r.target),s="";if(i.parent()){s=i.parent().attr("class")+""}if(!(i.parent().hasClass("combo-panel")||i.hasClass("comboBox_option")||i.hasClass("node_name")||s.indexOf("level")!=-1||s.indexOf("ztreeBox_down")!=-1)||(i.is(":input")&&i.attr("id")!=this.$textBox.attr("id"))){this.hidePanel()}};n.prototype.hidePanel=function(){var i=this.options;if(this.$panel.is(":hidden")){return}this.$panel.hide();if(i.required==true||i.validate!=null){this.validate()}this.options.onHidePanel.apply(this)};n.prototype.initPanelContent=function(){var s=this,i=this.options,u=i.textField,t=i.valueField;if(i.localdata.length){this.datas=i.localdata;r()}else{j.ajax({type:"POST",url:i.url,dataType:"json",async:false,data:i.queryParam,success:function(w){s.datas=w;r();if(i.formInitCallBack!=null){i.formInitCallBack(i.name)}},error:function(){}})}function r(){var z=new Object();if(i.searchOption==true){var y=false;j.each(s.datas,function(A){if(s.datas[A].text=="全部"){y=true;return false}});if(!y){z[u]="全部";z[t]="ALL";s.datas.unshift(z)}}else{if(i.searchOption==false){var x=false;j.each(s.datas,function(A){if(s.datas[A].text==""){x=true;return false}});if(!x){z[u]="";z[t]="";s.datas.unshift(z)}}}j.each(s.datas,function(A,B){var C=j("<div/>").addClass("comboBox_option").text(this[u]).attr("value",this[t]);s.$panel.append(C);j(C).data("optionObj",B);C.off("click").on("click",function(){var H=j(this),F="",D="",E=s.$textBox.data("oldValue"),G=[];if(!i.multiple){s.$panel.find(".comboBox_option").removeClass("comboBox_option_check");H.addClass("comboBox_option_check");s.$textBox.val(j(this).text())}else{H.toggleClass("comboBox_option_check")}j.each(s.$panel.find(".comboBox_option_check"),function(I,J){G.push(j(J).data("optionObj"));F+=j(J).text()+i.separator;D+=j(J).attr("value")+i.separator});if(F.length>0){F=F.substring(0,F.length-1);D=D.substring(0,D.length-1)}s.changeValue(D,F,G.length==1?G[0]:G);if(!i.multiple){s.hidePanel()}})});if(i.defaultValue!=""){s.setValue(i.defaultValue)}if(i.selected){var w=s.$panel.find(".comboBox_option");s.setValue(w.eq((i.selected)-1).attr("value"))}}};n.prototype.clear=function(){this.$panel.find(".comboBox_option_check").removeClass("comboBox_option_check");this.$valueBox.val("");this.$textBox.val("")};n.prototype.disable=function(){this.$textBox.attr("disabled","disabled").removeClass("bgwhite");this.$arrows.off("click")};n.prototype.enable=function(){var i=this;this.$textBox.removeAttr("disabled").addClass("bgwhite");this.$arrows.off("click").on("click",function(){i.clickToggle()})};n.prototype.setValue=function(r){var w=this,i="",r=r+"",u=[],s=this.options;if(s.multiple){if(r.indexOf(",")==-1){u[0]=r}else{u=r.split(",")}for(k in u){i+="[value='"+u[k]+"']"+s.separator}i=i.substring(0,i.length-1);var t=this.$panel.find(i);var x="";j.each(t,function(y,z){x+=j(z).text()+s.separator;j(z).addClass("comboBox_option_check")});x=x.substring(0,x.length-1);this.$textBox.val(x);this.$valueBox.val(r);this.$valueBox.val(r)}else{this.$panel.find("[value='"+r+"']").each(function(){j(this).addClass("comboBox_option_check").siblings().removeClass("comboBox_option_check");w.$valueBox.val(r);w.$textBox.val(j(this).text())})}};var o=l(n,{init:function(r,i){this.base(r,i);this.$tree;this.ztree}});j.fn.comboTree=function(i){var t=j.replaceTag(j(this),"INPUT"),s=null;if(typeof i=="object"){j.include([__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/zTreeStyle.css",__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/bootstrap-zTree-custom.css",__bootstrapVersionPath+"/plugins/tree/js/jquery.ztree.all.min.js"]);j.include([__bootstrapVersionPath+"/css/font-awesome.min.css"]);s=t.data("comboTree");if(s!=null){s.options=j.extend({},s.options,i);return}i=j.extend({},j.extend({},j.extend({},j.textBoxDefault,j.comboBoxDefault),j.treeDefault),i);t.data("comboTree",new o(t,i));t.data("type","comboTree");return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=t.data("comboTree");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};var e=[];var h=0;var c=[];o.prototype.initPanelContent=function(){var s=this,r=this.$textBox.attr("id")!=null?this.$textBox.attr("id")+"_tree":"comboTree_"+new Date().getTime(),i=this.options;c.push(i);this.$valueBox.attr("boxType","comboTree");s.$tree=j("<ul />").addClass("ztree").attr({id:r});s.$panel.append(s.$tree);this.$valueBox.attr("boxType","comboTree");this.$textBox.data("oldValue","");e.push(this);if(i.defaultValue){b=0}if(!i.multiple){i.callback.onClick=function(t,w,u){if(u.ISLEAF==0&&i.onlyLeaf){return}value=u[i.data.simpleData.idKey];text=u[i.data.key.name];e[b].changeValue(value,text,u);e[b].hidePanel()};h++}else{i.checkType="checkbox";i.check.enable="true";i.callback.onCheck=function(w,u,t){i=c[b];nodes=e[b].ztree.getCheckedNodes(true),v="",dv="";j.each(nodes,function(x,y){if(y.ISLEAF==0&&c[b].onlyLeaf){y.nocheck=true;return true}v+=y[c[b].data.key.name]+c[b].separator;dv+=y[c[b].data.simpleData.idKey]+c[b].separator});if(v.length>0){v=v.substring(0,v.length-1);dv=dv.substring(0,dv.length-1)}e[b].changeValue(dv,v,nodes)};i.callback.onClick=function(t,w,u){i=c[b];if(u.ISLEAF==0&&c[b].onlyLeaf){return}e[b].ztree.checkNode(u,!u.checked,null,true)};h++}if(i.url!=""){j.ajax({type:"POST",dataType:"json",url:i.url,async:false,data:i.queryParam,success:function(t){e[h-1].datas=t;e[h-1].processDate();e[h-1].ztree=j.fn.zTree.init(e[h-1].$tree,i,e[h-1].datas);if(i.defaultValue!=""){e[h-1].setValue(i.defaultValue)}if(i.formInitCallBack!=null){i.formInitCallBack(i.name)}}})}else{if(i.async!=null&&i.async.enable){e[h-1].ztree=j.fn.zTree.init(e[h].$tree,i);if(i.defaultValue!=""){e[h-1].setValue(i.defaultValue)}}else{e[h-1].datas=i.localdata;e[h-1].processDate();e[h-1].ztree=j.fn.zTree.init(e[h-1].$tree,i,e[h-1].datas);if(i.defaultValue!=""){e[h-1].setValue(i.defaultValue)}}}};o.prototype.setValue=function(s){var u=this,x="",r=[],w="",t=this.options,s=s+"",i=this.ztree.getNodesByParam(t.data.simpleData.idKey,s);if(t.multiple){if(s.indexOf(",")==-1){r[0]=s}else{r=s.split(",")}if(r.length==0){return}i=this.ztree.getNodesByFilter(function(y){return j.inArray(y[t.data.simpleData.idKey]+"",r)==-1?false:true});j.each(i,function(y,z){u.ztree.checkNode(z);x+=z[t.data.key.name]+t.separator;w+=z[t.data.simpleData.idKey]+t.separator});if(x.length>0){x=x.substring(0,x.length-1);w=w.substring(0,w.length-1)}this.$textBox.val(x);this.$valueBox.val(w)}else{if(i.length>0){this.ztree.selectNode(i[0]);this.$valueBox.val(i[0][t.data.simpleData.idKey]);this.$textBox.val(i[0][t.data.key.name])}}};o.prototype.processDate=function(){var r=this,i=this.options;if(i.rootElement){var s={};s[i.data.simpleData.idKey]=i.data.simpleData.rootPId;s[i.data.simpleData.pId]="";s.open=true;if(i.data.key.name){s[i.data.key.name]="全部";s.ISLEAF=0}this.datas.push(s)}j.each(this.datas,function(t,u){if(u.ISLEAF==0&&i.onlyLeaf){u.nocheck=true;return true}})};o.prototype.clear=function(){var i=this.ztree;j.each(i.getCheckedNodes(true),function(r,s){i.checkNode(s,!s.checked,null,true)});j.each(i.getSelectedNodes(),function(r,s){i.cancelSelectedNode(s,true)});this.$valueBox.val("");this.$textBox.val("")};o.prototype.getTree=function(){return this.ztree};var q=l(m,{init:function(r,i){this.base(r,i);this.that_id=j(r).attr("id")!=null?j(r).attr("id"):"searchTree_"+new Date().getTime();this.initModal();this.initModalContent();this.datas;this.ztree;this.$tree;this.$modal;this.lastNode}});q.prototype.initModal=function(){var u=this,r=this.options,t=this.$textBox,i=this.that_id,s='<div class="modal fade" id="'+i+'_modal" tabindex="-1" role="dialog" aria-labelledby="'+i+'_label" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title" id="'+i+'_label">'+r.modalTitle+'</h4></div><div class="modal-body"></div><div class="modal-footer"><button type="button" class="btn btn-default" style="float:left" id="'+i+'_clear">清空</button><button type="button" class="btn btn-default" data-dismiss="modal">关闭</button><button type="button" class="btn btn-primary" id="'+i+'_modalok">确定</button></div></div></div></div>';if(j("#"+i+"_modal")){j("#"+i+"_modal").remove()}j("body").append(s);this.$valueBox.attr("boxType","searchTree");t.removeAttr("name").removeAttr("dname").after('<i class="fa fa-angle-down combo-box-arrows"></i>');this.$modal=j("#"+i+"_modal").css("z-index",999999999);this.$modal.on("hidden.bs.modal",function(){if(r.required||r.validate){u.validate()}u.$tree.data("tree").searchNodes("");u.$modal.find(":text").val("")});t.parent().attr({"data-target":"#"+i+"_modal","data-toggle":"modal"});t.attr({readonly:"true"}).removeAttr("name");t.parent().attr("style",this.$textBox.attr("style"));t.removeAttr("style").css({width:"100%"}).addClass("empty form-control").data("oldValue","");j("#"+i+"_modalok").on("click",function(){u.doclick()});j("#"+i+"_clear").on("click",function(){u.clear()})};q.prototype.doclick=function(){var t=this,r=this.options,u=t.$tree.tree("getValue"),i=t.$textBox.data("oldValue"),s=this.$textBox;if(i!=u){t.$valueBox.val(u);s.data("oldValue",u).val(t.$tree.tree("getText"));t.options.onChange.call(t,u,i);if(r.required||r.validate){t.validate()}}t.options.onAckCallback.call(t,t.$tree.tree("getTree").getCheckedNodes());t.$modal.modal("hide")};q.prototype.initModalContent=function(){var t=this,i=this.that_id,s=this.$modal.find(".modal-body"),r=this.options;s.append('<ul id="'+i+'_mdTree" class="ztree searchTree"></ul>');this.$tree=j("#"+i+"_mdTree");r.view.dblClickExpand=false;r.callback["beforeClick"]=function(x,w){try{t.lastNode=w;if(w.ISLEAF==0){t.$tree.tree("getTree").expandNode(w)}}catch(y){}return true};r.callback["beforeDblClick"]=function(x,w){if(!w){return false}t.$tree.tree("getTree").checkNode(w,true,true,true);t.doclick();return false};this.$tree.tree(r);this.ztree=this.$tree.tree("getTree");var u=this.$modal.find(".treeWrap");u.css({maxHeight:j(window).height()/2,overflowY:"auto"});this.$modal.on("shown.bs.modal",function(){u.prev().focus()});if(r.defaultValue!=""){t.setValue(r.defaultValue)}};q.prototype.disable=function(){this.$textBox.attr("disabled","disabled").removeClass("bgwhite");this.$textBox.parent().removeAttr("data-target")};q.prototype.destroy=function(){this.$modal.remove();this.$outerBox.remove()};q.prototype.enable=function(){this.$textBox.removeAttr("disabled").addClass("bgwhite");this.$textBox.parent().attr("data-target","#"+this.that_id+"_modal")};q.prototype.getText=function(){return this.$textBox.val()};q.prototype.setValue=function(i){this.$tree.tree("setValue",i);this.$textBox.val(this.$tree.tree("getText"));this.$valueBox.val(this.$tree.tree("getValue"))};q.prototype.clear=function(){this.$tree.tree("clearTree");this.$textBox.data("oldValue","");this.$textBox.val("");this.$valueBox.val("")};q.prototype.reload=function(i){this.setValue("");this.$tree.tree("reload",i)};q.prototype.getTree=function(){return this.ztree};q.prototype.onTrigger=function(){};j.fn.searchTree=function(i){var t=j.replaceTag(j(this),"INPUT"),s=null;if(typeof i=="object"){j.include([__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/zTreeStyle.css",__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/bootstrap-zTree-custom.css",__bootstrapVersionPath+"/plugins/tree/js/jquery.ztree.all.min.js"]);j.include([__bootstrapVersionPath+"/css/font-awesome.min.css"]);s=t.data("searchTree");if(s!=null){s.options=j.extend({},s.options,i);return}i=j.extend({},j.extend({},j.textBoxDefault,j.searchTreeDefault),i);t.data("searchTree",new q(t,i));t.data("type","searchTree");return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=t.data("searchTree");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};var p=function(r,i){this.$tree=r;this.options=i;this.$searchBox;this.$outerBox;this.datas;this.ztree=null;this.initTree(r,i);this.initsearchBox()};j.fn.tree=function(i){var u=j.replaceTag(j(this),"UL");if(typeof i=="object"){j.include([__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/zTreeStyle.css",__bootstrapVersionPath+"/plugins/tree/css/zTreeStyle/bootstrap-zTree-custom.css",__bootstrapVersionPath+"/plugins/tree/js/jquery.ztree.all.min.js",__bootstrapVersionPath+"/plugins/tree/js/jquery.ztree.exhide.min.js"]);i=j.extend(true,{},j.treeDefault,i);var r=new p(u,i);u.data("tree",r);return}if(typeof i=="string"){var s,w=Array.prototype.slice.call(arguments,1),t=u.data("tree");s=t[i].apply(t,w);return typeof s==="undefined"?this:s}};p.prototype.getTree=function(){return this.ztree};p.prototype.getValue=function(){var i=this.ztree.getCheckedNodes(),r=this,s="",t=r.options.getValueField;j.each(i,function(u,w){if(t===""){s+=w[r.options.data.simpleData.idKey]+","}else{s+=w[t]+","}});if(s.length>0){s=s.substring(0,s.length-1)}return s};p.prototype.getText=function(){var i=this.ztree.getCheckedNodes(),r=this,s="";j.each(i,function(t,u){s+=u[r.options.data.key.name]+","});if(s.length>0){s=s.substring(0,s.length-1)}return s};p.prototype.initTree=function(){var w=null,x=this.$tree,r=this.options,u=this,t=x.attr("id")!=null?x.attr("id"):"tree_"+new Date().getTime();x.addClass("ztree").attr("id",t);if(r.checkType=="radio"){r.check.enable="true";r.check.chkStyle="radio";r.check.radioType="all"}else{if(r.checkType=="checkbox"){r.check.enable="true"}}r.callback.onClick=function(C,B,A,z){u.ztree.checkNode(A,null,false,false);u.options.callback.clickNode.call(u,C,B,A,z)};var i={fontCss:y};r.view=j.extend({},i,r.view);function y(A,z){return z.color!=null?{color:z.color}:{}}if(this.options.url!=""){j.dajax({url:r.url,data:r.queryParam,async:false,success:function(z){u.datas=z;s();w=j.fn.zTree.init(x,r,z);u.ztree=w;r.onLoaded.call(x,u.ztree);if(r.formInitCallBack!=null){r.formInitCallBack(r.name)}}})}else{if(this.options.localdata!=null){u.datas=this.options.localdata;s();this.ztree=j.fn.zTree.init(x,r,r.localdata);r.onLoaded.call(x,u.ztree)}else{this.ztree=j.fn.zTree.init(x,r);r.onLoaded.call(x,u.ztree)}}function s(){if(r.rootElement){var z={};z[r.data.simpleData.idKey]=r.data.simpleData.rootPId;z[r.data.simpleData.pId]="";z.open=true;if(r.data.key.name){z[r.data.key.name]="全部";z.ISLEAF=0}u.datas.push(z)}j.each(u.datas,function(A,B){B.chkDisabledInherit=true;if(B.ISLEAF==0&&!r.ISLEAF){B.nocheck=true;return true}})}if(r.outerHeight!=undefined){var x=this.$tree;x.wrap('<div class="treeWrap"></div>');x.parent().css({height:r.outerHeight,overflowY:"auto"})}};p.prototype.initsearchBox=function(){var i=this.options,s=this.$tree,r=this;if(i.openSearch==true){this.$searchBox=j("<input/>").attr({type:"text",placeholder:i.searchPlaceholder?i.searchPlaceholder:"请输入关键字,按回车确认",id:s.attr("id")+"_searchBox"}).addClass("form-control input-sm tree_search").css("width","100%");s.before(this.$searchBox);this.$searchBox=s.prev(".tree_search");s.wrap('<div class="treeWrap"></div>');this.$outerBox=s.parent();this.$outerBox.css({height:this.options.fixedTreeHeight,overflowY:"auto"});this.$searchBox.on("focus",function(){var w=r.$searchBox.parents(".modal");var t=[],u=[];var x=r.ztree;var y="",z="";r.$searchBox.on("keydown",function(A){if(A.which==13){if(r.options.openSearch&&r.options.dblEnterSearch){y=r.$searchBox.val();if(y!=z){t=r.searchNodes(j.trim(r.$searchBox.val()));if(t.length>0){u.splice(0,u.length);j.each(t,function(B){if(!t[B].nocheck){u.push(t[B])}})}z=y}else{if(u.length==1){x.checkNode(u[0],true,true);w.find("[id$='_modalok']").click()}}}else{r.searchNodes(j.trim(r.$searchBox.val()))}}})});this.$searchBox.on("blur",function(){r.$searchBox.off("keydown")})}};p.prototype.searchNodes=function(x){var u=this.options,s=this.ztree,r=[],i=s.transformToArray(s.getNodes());if(x==""){s.showNodes(i);return r}w(false);r=s.getNodesByParamFuzzy(u.data.key.name,x,null);w(true);return r;function w(y){s.hideNodes(i);for(var z in r){t(s,r[z]);r[z].highlight=y;s.updateNode(r[z])}s.showNodes(r)}function t(y,A){y.expandNode(A,true,false,false);var z=A.getParentNode();if(z!=null){r.push(z);t(y,z)}}};p.prototype.clearTree=function(){var r=this.ztree,i=r.getCheckedNodes();r.cancelSelectedNode();j.each(i,function(s,t){r.checkNode(t,false,false,false)})};p.prototype.setValue=function(t){this.clearTree();var s=this,t=t+"",r=[],i=s.ztree.transformToArray(s.ztree.getNodes());if(t.indexOf(",")==-1){r[0]=t}else{r=t.split(",")}j.each(r,function(u,w){j.each(i,function(x,y){if(w==y[s.options.data.simpleData.idKey]){s.ztree.checkNode(y,null,false,false);s.ztree.selectNode(y,true);return true}})})};p.prototype.reload=function(i){this.ztree.destroy();this.options=j.extend({},this.options,i);this.initTree(this.$tree,this.options)};p.prototype.destroy=function(){var i=this.$tree;this.ztree.destroy();if(this.$searchBox!=undefined){this.$outerBox.remove()}else{i.remove()}};var g=false;function l(r,t){if(typeof(r)==="object"){t=r;r=null}function s(){if(!g){if(r){this.baseprototype=r.prototype}this.init.apply(this,arguments)}}if(r){g=true;s.prototype=new r();s.prototype.constructor=s;g=false}for(var i in t){if(t.hasOwnProperty(i)){if(r&&typeof(t[i])==="function"&&typeof(s.prototype[i])==="function"){s.prototype[i]=(function(u,w){return function(){this.base=r.prototype[u];return w.apply(this,arguments)}})(i,t[i])}else{s.prototype[i]=t[i]}}}return s}var f=l(m,{init:function(r,i){this.base(r,i);this.initDecimal()}});j.fn.decimal=function(i){var t=j.replaceTag(j(this),"INPUT"),s=null;if(typeof i=="object"){s=t.data("decimal");if(s!=null){s.options=j.extend({},s.options,i);return}i=j.extend({},j.textBoxDefault,i);t.data("decimal",new f(t,i));t.data("type","decimal");return}if(typeof i=="string"){var r,u=Array.prototype.slice.call(arguments,1),s=t.data("decimal");r=s[i].apply(s,u);return typeof r==="undefined"?this:r}};f.prototype.initDecimal=function(){var t=this.$textBox,s=this.options;var i=1;for(var r=0;r<s.decimalPlaces;r++){i=i/10}t.attr({step:i}).val(i);t.attr("type","number");if(t.parent().siblings().is(".control-identify")){t.parent().siblings().remove()}if(s.labeltitle){if(s.labelbreadth==undefined){s.labelbreadth="100px"}t.parent().before('<label class="control-label control-identify" for="" style="width:'+s.labelbreadth+' ;line-height:30px;text-align:center;">'+s.labeltitle+"</label>");t.parent().parent().css("display","flex")}this.$valueBox.attr("boxType","decimal");if(s.decimalPlaces>0){t.on("blur",function(){var x=parseInt(s.decimalPlaces)+2;var w=parseFloat(t.val()).toFixed(x);var u=w.substring(0,w.lastIndexOf(".")+(x-1));t.val(u)})}}})(jQuery);